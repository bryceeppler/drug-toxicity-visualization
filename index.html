<!DOCTYPE html>
<html>
  <head>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>
    <style>
      .line {
        fill: none;
        stroke: steelblue;
        stroke-width: 2px;
      }
      .node {
        border: solid 1px black;
        font: 10px sans-serif;
        line-height: 12px;
        overflow: hidden;
        position: absolute;
        text-indent: 2px;
      }
      .vis-container {
        width: 600px;
        padding: 5px;
        background-color: white;
        border-radius: 5px;
        box-shadow: 0 0 5px 0 rgba(0, 0, 0, 0.5);
        margin: 5px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <div
      style="
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      "
    >
    <div class="vis-container">
        <h3>Line chart</h3>
      <svg class="linechart" width="560" height="500"></svg>
    </div>
    <div class="vis-container">
        <h3>Treemap</h3>
      <svg class="treemap" width="560" height="500"></svg>
    </div>
    <div class="vis-container">
        <h3>Bubblemap</h3>
      <svg class="bubblemap" width="560" height="800"></svg>
    </div>
    </div>
    <!-- Line Chart -->
    <script>
      var svg = d3.select(".linechart"),
        margin = { top: 20, right: 20, bottom: 30, left: 50 },
        width = +svg.attr("width") - margin.left - margin.right,
        height = +svg.attr("height") - margin.top - margin.bottom,
        g = svg
          .append("g")
          .attr("transform", `translate(${margin.left},${margin.top})`);

      const parseTime = d3.timeParse("%d-%b-%y");

      const x = d3.scaleTime().rangeRound([0, width]);
      const y = d3.scaleLinear().rangeRound([height, 0]);

      const line = d3
        .line()
        .x(function (d) {
          return x(d.date);
        })
        .y(function (d) {
          return y(d.deaths);
        });

      const data = [
        { date: "1-Jan-17", deaths: 24 },
        { date: "1-Feb-17", deaths: 29 },
        { date: "1-Mar-17", deaths: 36 },
        { date: "1-Apr-17", deaths: 48 },
        { date: "1-May-17", deaths: 77 },
        { date: "1-Jun-17", deaths: 74 },
        { date: "1-Jul-17", deaths: 90 },
        { date: "1-Aug-17", deaths: 94 },
        { date: "1-Sep-17", deaths: 98 },
        { date: "1-Oct-17", deaths: 104 },
        { date: "1-Nov-17", deaths: 110 },
        { date: "1-Dec-17", deaths: 119 },
        { date: "1-Jan-18", deaths: 116 },
        { date: "1-Feb-18", deaths: 119 },
        { date: "1-Mar-18", deaths: 132 },
      ];

      data.forEach(function (d) {
        d.date = parseTime(d.date);
        d.deaths = +d.deaths;
      });

      x.domain(
        d3.extent(data, function (d) {
          return d.date;
        })
      );
      y.domain([
        0,
        d3.max(data, function (d) {
          return d.deaths;
        }),
      ]);

      g.append("g")
        .attr("transform", `translate(0,${height})`)
        .call(d3.axisBottom(x).ticks(5))
        .select(".domain")
        .remove();

      // create an alternating background color along the x-axis for each month
      g.selectAll("rect")
        .data(data)
        .enter()
        .append("rect")
        .attr("x", function (d) {
          return x(d.date);
        })
        .attr("y", 0)
        .attr("width", width / data.length)
        .attr("height", height)
        .attr("fill", function (d, i) {
          return i % 2 == 0 ? "#7CDF6C" : "#FF2E00";
        })
        .attr("opacity", 0.2);

      g.append("g")
        .call(d3.axisLeft(y))
        .append("text")
        .attr("fill", "#000")
        .attr("transform", "rotate(-90)")
        .attr("y", 6)
        .attr("dy", "0.71em")
        .attr("text-anchor", "end")
        .text("Illicit Drug Deaths");

      g.append("path")
        .datum(data)
        .attr("fill", "none")
        .attr("stroke", "steelblue")
        .attr("stroke-linejoin", "round")
        .attr("stroke-linecap", "round")
        .attr("stroke-width", 1.5)
        .attr("d", line);
    </script>

    <!-- Treemap -->
    <script>
      var treemapData = {
        name: "root",
        children: [
          { name: "Victoria", value: 100 },
          { name: "Vancouver", value: 323 },
          { name: "Nanaimo", value: 54 },
          { name: "Prince George", value: 46 },
        ],
      };

      var svg = d3.select(".treemap");

      var treemap = d3.treemap().size([560, 500]).padding(1);

      var root = d3
        .hierarchy(treemapData)
        .sum(function (d) {
          return d.value;
        })
        .sort(function (a, b) {
          return b.value - a.value;
        });

      treemap(root);

      var node = svg
        .selectAll(".node")
        .data(root.leaves())
        .enter()
        .append("rect")
        .attr("class", "node")
        .attr("x", function (d) {
          return d.x0;
        })
        .attr("y", function (d) {
          return d.y0;
        })
        .attr("width", function (d) {
          return d.x1 - d.x0;
        })
        .attr("height", function (d) {
          return d.y1 - d.y0;
        })
        .style("fill", function (d) {
          return "#4682B4";
        });
    </script>

    <!-- Bubble Map -->
    <script>
      var svg = d3.select(".bubblemap");

      var vancouver = [49.2827291, -123.1207375];
      var victoria = [48.4284207, -123.3656444];

      var projection = d3
        .geoMercator()
        .center([-120.3656444, 53.2827291])
        .scale(2000)
        .translate([svg.attr("width") / 2, svg.attr("height") / 2]);

      var markers = [
        {
          // Vancouver
          long: -123.1207375,
          lat: 49.2827291,
          value: 323,
        },
        {
          // Victoria
          long: -123.55,
          lat: 48.55,
            value: 100,
        },
        {
            // Nanaimo
            long: -123.9361111,
            lat: 49.1652778,
            value: 64,
        },
        {
            // Prince George
            long: -122.7494444,
            lat: 53.9166667,
            value: 96,
        },
        {
            // Kelowna
            long: -119.4927778,
            lat: 49.8877778,
            value: 46,
        },
        {
            // Abbotsford
            long: -122.3002778,
            lat: 49.0577778,
            value: 123,
        }

      ];

      // Draw the map
      d3.json("https://d3js.org/world-110m.v1.json").then(function (data) {
        svg
          .append("g")
          .selectAll("path")
          .data(topojson.feature(data, data.objects.countries).features)
          .enter()
          .append("path")
          .attr("d", d3.geoPath().projection(projection))
          .style("fill", "#4682B4")
          .style("stroke", "black")
          .style("opacity", 0.3);
      });

      // Draw the markers
      svg
        .selectAll("circle")
        .data(markers)
        .enter()
        .append("circle")
        .attr("cx", function (d) {
          return projection([d.long, d.lat])[0];
        })
        .attr("cy", function (d) {
          return projection([d.long, d.lat])[1];
        })
        .attr("r", function (d) {
          return d.value / 10;
        })
        .style("fill", "#4682B4")
        .style("stroke", "white")
        .style("opacity", 0.8);
    </script>
  </body>
</html>
